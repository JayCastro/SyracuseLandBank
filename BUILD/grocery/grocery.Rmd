---
title: "Grocery"
author: "Christine Brown"
date: "April 19, 2017"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,  warning = F , message = F)
```
Set-Up
```{r}
#Load Packages
library( dplyr )
library( geojsonio )
library( ggmap )
library( maps )
library( maptools )
library( raster )
library( rgdal )
library( rgeos )
library( sp )

setwd("C:/Users/brown/Documents/Grad School/Fall 16/DDMII/SyracuseLandBank/DATA/RAW_DATA")
```


```{r}

#Get Grocery Data from Community Geography
dir.create("C:/Users/brown/Documents/Grad School/Fall 16/DDMII/SyracuseLandBank/DATA/RAW_DATA/Grocery")
setwd("C:/Users/brown/Documents/Grad School/Fall 16/DDMII/SyracuseLandBank/DATA/RAW_DATA/Grocery")
download.file("http://communitygeography.org/wp-content/uploads/2015/08/Supermarkets.shp_.zip", "supermarkets.zip" )
unzip( "supermarkets.zip" )
file.remove( "supermarkets.zip" )

#Change Original Data into Shapefile and Convert to CSV
grocery <- readShapePoints( fn="Supermarkets", proj4string=CRS("+proj=longlat +datum=WGS84") )
setwd("C:/Users/brown/Documents/Grad School/Fall 16/DDMII/SyracuseLandBank/DATA/RAW_DATA")
write.csv(grocery@data, file = "grocery_raw.csv", row.names=FALSE)

#Delete Community Geography File because CSV Has All Information
unlink("C:/Users/brown/Documents/Grad School/Fall 16/DDMII/SyracuseLandBank/DATA/RAW_DATA/Grocery", recursive = TRUE)



#Load Data
grocery <- read.csv( "https://raw.githubusercontent.com/christine-brown/SyracuseLandBank/master/DATA/RAW_DATA/grocery_raw.csv", stringsAsFactors=FALSE )
syr_tracts <- geojson_read( "https://raw.githubusercontent.com/christine-brown/SyracuseLandBank/master/SHAPEFILES/SYRCensusTracts.geojson", method="local", what="sp" )
syr_tracts <- spTransform( syr_tracts, CRS( "+proj=longlat +datum=WGS84" ) )

#Clean Data
grocery$City <- ifelse( is.na( grocery$City ), grocery$ARC_City_1, grocery$City )
grocery <- mutate( grocery, Address=paste( Location, City, "NY", ZipCode, sep=", " ) )
grocery <- grocery[ , c( "Supermarke", "Address" ) ]

#Geocode
grocery_coordinates <- suppressMessages( geocode( grocery$Address, messaging=F ) )
grocery <- cbind( grocery, grocery_coordinates )

#Match to Census Tract
grocery_coordinates_SP <- SpatialPoints( grocery_coordinates, proj4string=CRS("+proj=longlat +datum=WGS84" ) )
grocery_tracts <- over( grocery_coordinates_SP, syr_tracts ) # note that this will only provide information for stores in Syracuse census tracts, so many of the stores will have NA as values
grocery <- cbind( grocery, grocery_tracts )
grocery <- filter( grocery, !is.na( INTPTLON10 ) )

#Export to CSV
write.csv( grocery, file = "grocery_processed.csv", row.names=FALSE )


#Load Data
grocery <- read.csv( "https://raw.githubusercontent.com/christine-brown/SyracuseLandBank/master/DATA/PROCESSED_DATA/grocery_processed.csv", stringsAsFactors=FALSE )
grocery_tract <- as.data.frame( table( grocery$GEOID10 ) )

names( grocery_tract ) <- c( "GEOID10", "GROCERY2015" )

#Export to CSV
write.csv( grocery_tract, file = "grocery_final.csv", row.names=FALSE )





```